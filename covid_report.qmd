---
title: "Les efftes du confinement de la pandémie de Covid 19 sur divers paramètres sociaux et économiques : Report."
author: "Achille Dekkers, Maxime Pourtois, Oguzhan Dogru, Tanguy Deprez"
format:
  pdf:
    documentclass: report
    toc: true
editor: visual
lang: fr
---

<!--# Ce travail doit faire entre 15 et 20 pages.-->

<!--# Un rapport est différent d'un carnet de notes. Il ne s'agit donc pas de faire du copier-coller d'un document vers l'autre. Un rapport de synthèse doit être compréhensible sans devoir lire le carnet de notes. Le rapport de synthèse doit être  rédigé avec un style et une présentation adéquats. -->

## Introduction

<!--% Rédigez l'introduction de ce rapport.-->

Tout au long de l'année, la fréquentation de certains lieux varie selon les périodes. Par exemple, une baisse de fréquentation du lieu de travail est souvent observée durant les vacances d'été. La fréquentation de certains lieux peut donc être anticipée ou cyclique, mais des situations exceptionnelles peuvent impacter directement celle des lieux du quotidien, comme ce fut le cas lors de la pandémie de Covid-19. Le confinement et l'ensemble des restrictions qui en ont découlé ont fortement influencé le quotidien de chacun.

## But

<!--% Rédigez le but de ce rapport.-->

Ce rapport vise à mettre en évidence les effets de la Covid19 sur tout un aspect du fonctionnement de la société, d'un point de vue économique comme social.

## Matériel et méthodes

<!--% Cette section doit comprendre deux parties. La première partie doit expliciter le données employées et la seconde traiter des analyses réalisées et des logiciels employés.-->

Les données utilisées sont celles des rapports de mobilité communautaire COVID-19 de Google pour la Wallonie (Google COVID-19 Community Mobility Reports). Elles donnent, pour chaque jour, la variation en pourcentage de la fréquentation de six types de lieux (vente au détail et loisirs, épiceries et pharmacies, parcs, stations de transport en commun, lieux de travail, zones résidentielles) par rapport à une période de référence avant la pandémie. Dans ce travail, on se concentre surtout sur la période 2020–2021, qui correspond aux années où les mesures liées à la COVID-19 ont le plus modifié la mobilité en Wallonie.

L’analyse est réalisée dans la [SciViews Box 2025](https://www.sciviews.org/software/svbox/) sur [Saturn Cloud](https://saturncloud.io) (Linux Ubuntu 22.04) avec le logiciel R (`r R.version.string`). On utilise l’environnement `SciViews::R("ts", lang = "fr")` et les fonctions “speedy” pour renommer les variables, garder les colonnes utiles et préparer les séries. Les pourcentages de variation sont transformés en séries temporelles journalières régulières (`ts`, fréquence 365). Pour certaines variables, on construit aussi des séries hebdomadaires (parfois en mettant les week-ends à NA et en agrégeant ensuite par moyenne hebdomadaire) (aggregate()). La structure temporelle est étudiée avec la fonction d’autocorrélation (acf()), l’analyse spectrale (spectrum()) et des tests de tendance (trend.test() du package {pastecs} `r packageVersion("pastecs")`). Enfin, on décompose les séries en tendance, composante saisonnière et résidus avec tsd() (méthodes average et loess), appliqué séparément aux différentes catégories de lieux selon la personne du groupe responsable de chaque série.

## Résultats

<!--% Présentez les analyses les plus pertinents que vous avez sélectionnés. Structurez la section en partie avec des titres explicites de niveau trois.-->

### Mise en place de l'environnement de travail

```{r setup, include=FALSE}
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts", lang = "fr")
feur <- read("data/mobility_wallonia.rds")
```

```{r}
feur %>.%
  smutate(., 
    "retail" = retail_and_recreation_percent_change_from_baseline,
    "grocery" = grocery_and_pharmacy_percent_change_from_baseline,
    "parks" = parks_percent_change_from_baseline,
    "transit" = transit_stations_percent_change_from_baseline,
    "workplaces" = workplaces_percent_change_from_baseline,
    "residential" = residential_percent_change_from_baseline,
     retail = labelise(retail_and_recreation_percent_change_from_baseline, "Variation du pourcentage de la fréquentation des zones de vente au détail et des loisirs par rapport à la base"),
    grocery = labelise(grocery, "Variation du pourcentage de la fréquentation des épiceries et pharmacies par rapport au niveau de base"), 
    parks = labelise(parks, "Variation du pourcentage de la fréquentation des parcs"), 
      transit = labelise(transit, "Variation en pourcentage de la fréquentation des stations de transit par rapport à la référence"), 
      workplaces = labelise(workplaces, "Variation en pourcentage de la fréquentation des lieux de travail par rapport à la base"),
      residential = labelise(residential, "Variation en pourcentage de la fréquentation des zones résidentielles par rapport à la base")
  ) -> feur
sselect(feur, c(1, 8, 9, 10, 11, 12, 13)) -> feur
```

```{r}
retail_ts <- ts(feur$retail, start = c(2020, 46), frequency = 365)
grocery_ts <- ts(feur$grocery,  start = c(2020, 46), frequency = 365)
parksts <- ts(feur$parks,  start = c(2020, 46), frequency = 365)
transit_ts <- ts(feur$transit,  start = c(2020, 46), frequency = 365)
workplaces_ts <- ts(feur$workplaces,  start = c(2020, 46), frequency = 365)
residential_ts <- ts(feur$residential,  start = c(2020, 46), frequency = 365)
```

### Influence sur les épiceries et pharmacies

```{r Série grocery}
plot(grocery_ts, main = "Fréquentation des épiceries et pharmacies durant la pandémie de Covid 19", xlab = "Années", ylab = "")
```

Représentation graphique de la série initiale.

```{r}
grocery_decomp_loess <- tsd(grocery_ts, method = "loess", s.window = 7, trend = TRUE)
plot(grocery_decomp_loess, col = 1:3)
```

La série a été décomposée par LOESS. Une tendance à la hausse se dégage de l'analyse. Il ne semble pas y avoir de grandes variations liées au confinement à première vue.

```{r}
grocery_loess <- tseries(grocery_decomp_loess)
spectrum(grocery_loess[, "seasonal"], spans = c(5, 7))
```

On observe grâce à l'analyse spectrale la présence d'un cycle significatif vers 50 ce qui représente un cycle significatif de 7 jours. Les fréquentations des épiceries et pharmacies ont l'air donc de varier de manière hebdomadaire.

```{r}

feur_date<-sfilter(feur, date >= as.Date("2020-02-15"),  date <= as.Date("2021-12-31"))
feur_datewd <- feur_date
feur_datewd$weekdays <- weekdays(as.POSIXct(feur_datewd$date))
# Les données du week-end sont remplacées par des valeurs manquantes
feur_datewd[feur_datewd$weekdays == "Saturday" | feur_datewd$weekdays == "Sunday" , 2:7] <- NA 
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
grocery_tswd <- ts(feur_datewd$grocery, start = c(2021, 46), frequency = 365)
# Aggrégation par moyenne des valeurs par semaine
grocery_tswd2 <- aggregate(grocery_tswd, 52, FUN = collapse::fmean, ts.eps = 1/52)


grocery_decomp_loess2 <- tsd(grocery_tswd2, method = "average", order = 26)
plot(grocery_decomp_loess2, col = 1:3)

```

Ici nous avons extraits les deux jours du week-ends de la série initiale pour analyser une possible tendance ou un possible cycle.

Un tendance à la hausse se dégage plutôt bien lors de la réalisation de la LOESS, mais un palier est quand même présent au début, au tout début de la pandémie. On voit d'ailleurs assez bien la chute de fréquentation au début du confinement sur la série aggregée.

Concerant les cycles, après une analyse spectrale, aucun cycle ne semble se dégager de manière significative, il ne semble donc pas y avoir de cycles dans notre série modifiée "semaine".

```{r}
feur_datewk <- feur_date
feur_datewk$weekdays <- weekdays(as.POSIXct(feur_datewk$date))
# Les données du week-end sont remplacées par des valeurs manquantes
feur_datewk[feur_datewk$weekdays == c("Monday") |feur_datewk$weekdays == c("Tuesday") |feur_datewk$weekdays == c("Wednesday") |feur_datewk$weekdays == c("Thursday") |feur_datewk$weekdays == c("Friday") , 2:7] <- NA 
grocery_tswk <- ts(feur_datewk$grocery, start = c(2020, 46), frequency = 365)

grocery_tswk2 <- aggregate(grocery_tswk, 52, FUN = collapse::fmean, ts.eps = 1/52)

grocery_decomp_loess3 <- tsd(grocery_tswk2, method = "average", order = 26)
plot(grocery_decomp_loess2, col = 1:3)
```

La même analyse a été effectuée sur les jours de week-ends. Les résultats sont sensiblement identiques, il n'y a pas de cycles significatifs.

### Influence sur le monde du travail

```{r}
feur_OD2 <- sfilter(feur, date >= as.Date("2020-02-15"))
feurdw2 <- feur_OD2
feurdw2$weekday <- weekdays(as.POSIXct(feurdw2$date))
feurdw2[feurdw2$weekday %in% c("Saturday","Sunday","samedi","dimanche"), "workplaces"] <- NA
workdw2 <- ts(feurdw2$workplaces, start = c(2020, 46), frequency = 365)
workweek2 <- aggregate(workdw2, 52, FUN = collapse::fmean, ts.eps = 1/52)

plot(workweek2, main = "Fréquentation hebdomadaire des lieux de travail", ylab = "% par rapport à la base", xlab = "")
```

La chute drastique de la fréquentation des lieux de travail peut se voir sur ce graphique, avec le début du confinement qui mène ce paramètre au point le plus bas du temps considéré.

```{r}
feur_OD<-  sfilter(feur, date >= as.Date("2020-02-15"),  date <= as.Date("2021-12-31"))

feurw <- feur_OD
feurw$weekday <- weekdays(as.POSIXct(feurw$date))

#On met NA a la place des w-e pour se concentrer sur les jours ouvrables.

feurw[feurw$weekday %in% c("Saturday", "Sunday", "samedi", "dimanche"), "workplaces"] <- NA
workdw <- ts(feurw$workplaces, start = c(2020, 46), frequency = 365)
workweek <- aggregate(workdw, 52, FUN = collapse::fmean, ts.eps = 1 / 52)

spectrum(workweek, spans = c(3,5), main = "Spectre - série hebdomadaire")
```

D'après l'analyse spectrale, il semble qu'il existe 3 cycles mais au vu de la forte proximité au seuil du 3ème, nous ne le considérerons pas. Il faut aussi prendre en compte que l'étude ne s'est faite que sur un cadre de deux ans, il peut être aussi compliqué considérer que ce spectre ait une réelle valeur pour la démonstration.

```{r}
workweek_trend_test <- trend.test(workweek2, R = 999)

plot(workweek_trend_test, main = "Test de tendance - série hebdomadaire")
par(mfrow = c(1,1))
```

En revanche, le test de tendance semble confirmer la présence d'une tendance.

```{r}
workweek_loess <- tsd(workweek2, method = "loess", s.window = 53, trend = TRUE)

plot(workweek_loess, main = "Décomposition - lieux de travail (hebdom.)")
```

En décomposant la série temporelle, on peut effectivement voir une tendance de la fréquentation du milieu de travail à remonter. Cela semble logique car la société commence à reprendre son cours malgré la pandémie mais on voit aussi que le niveau de fréquentation initial n'est pas rétabli dans le laps de temps. On voit aussi une certaine saisonnalité dans un motif qui semble se répéter annuellement.

### Influence sur les zones de vente au détail et des loisirs

```{r série brute de retail}
feur_date<-sfilter(feur, date >= as.Date("2020-02-15"),  date <= as.Date("2021-12-31"))

retail_ts1 <- ts(feur_date$retail, start = c(2020, 46), frequency = 365)

plot(retail_ts1, main = "Fréquentation des lieux de vente au détail et loisirs ", ylab = "% par rapport à la valeur de référence")
```

Cette série temporelle illustre l'impact des restrictions sanitaires sur la fréquentation des lieux de vente au détail et des loisirs entre 2020 et 2022. On y observe une trajectoire en "W" avec une première chute brutale de -80% lors du premier confinement, suivie d'une reprise éphémère, puis d'une seconde baisse plus étalée durant les vagues hivernales de 2020-2021. La période finale marque un retour à la normale, voire un dépassement de la valeur de référence. L'analyse révèle également ce qui semble être un cycle hebdomadaire couplée à des chocs ponctuels négatifs qui reflètent l'arrêt de l'activité lors des jours fériés.

```{r tendance générale bootstrap retail}
set.seed(144946)
retail_trend <- trend.test(retail_ts1, R = 999)
plot(retail_trend, main = "Test de tendance-Fréquentation des lieux de vente au détail et loisirs")
```

D'après cette histogramme, que la p-value semble bien inférieur à la valeur seuil de 0.05 avec une valeur proche de 0. Nous rejetons H0 et on peut en conclure qu’une tendance générale significative au seuil α existe dans la série.

```{r Décompostion de retail}
retail_tsd <- tsd(retail_ts1, method = "average", order = 3)

plot(retail_tsd, main = "Décomposition de la fréquentation des zones de vente au détail et loisirs", col = 1:3)
```

En décomposant la série par moyenne mobile on peut voir que le filtrage reprend la tendance générale de baisse de fréquentation et la reprise dû aux différentes décisions gouvernementale face à la situation sanitaire.

En regardant les résidus, on peut voir de très nombreux pics, avec des valeurs extrêmes négatives qui peuvent s'expliquer par la fermeture les magasins de vente au détail et loisirs mais pas uniquement à cause de la pandémie. Les résidus semblent en parti suivre le calendrier avec des baisses de fréquentation possible le dimanche ou les jours fériés de par leur fermeture mais aussi l'évolution du pouvoir d'achat pour les zones de vente au détail.

### Impact sur la fréquentation des zones résidentielles

```{r fréquentation résidentielle brute}
resid_ts1 <- ts(feur_date$residential, start = c(2020, 46), frequency = 365)

plot(resid_ts1, main ="Fréquentation des lieux de vente au détail et loisirs ", ylab = "% par rapport à la valeur de référence")
```

Contrairement à la fréquentation des points de ventes, la fréquentation des zones résidentielles a fortement augmenté suite au confinement de la population ce qui est logique, avec un pic allant jusque 30% de fréquentation supplémentaire par rapport à la période pré covid. On remarque cependant que même après la levé du confinement les personnes on eu tendance à rester chez eux malgré tout. On ne voit que de rare pics où cette fréquentation a été moins importante qu'avant la pandémie.

```{r Décomposition de retail}
resid_tsd <- tsd(resid_ts1, method = "average", order = 3)

plot(resid_tsd, col = 1:3, main = "Décomposition de la fréquentation des zones résidentielles")
```

La persistance d'une tendance positive dans la composante lissée confirme que la pandémie a durablement ancré le domicile comme centre de gravité, via la généralisation du télétravail et des loisirs domestiques. Ces "bosses" successives témoignent ainsi d'une adaptation comportementale profonde de la population, qui s'ajuste en temps réel au rythme des vagues sanitaires et des restrictions associées.

### Influence sur la fréquentation des parcs

```{r}
parks <- ts(feur$parks)

library(zoo)
dates <- seq(as.Date("2020-02-15"), by = "day", length.out = length(parks))
z <- zoo(parks, dates)
plot(z, type = "l", xlab = "Dates", ylab = "Variation de la fréquentation des parcs")
abline(v = as.Date("2020-03-18"), col = "2", lty = 3)
abline(v = as.Date("2020-05-04"), col = "3", lty = 3)
abline(v = as.Date("2020-10-20"), col = "2", lty = 3)
abline(v = as.Date("2021-02-01"), col = "3", lty = 3)
```

En rouge : début de confinement En vert : fin de confinement

Cette analyse met en évidence la diminution drastique de la fréquentation des parcs au moment du premier confinement. Après les 2 confinements, on constate une augmentation progressive de la fréquentation. Cela dit, il s'agit très probablement d'une augmentation due à l'arrivée des températures plus douce du printemps et de l'été, comme le montre l'analyse suivante.

```{r}
library(forecast)
parkstsclean <- na.interp(parksts)
spectrum(parkstsclean, spans = c(3,5))
```

De plus, on peut constater une tendance à la hausse très marquée et qui finalement arrive à un plateau. Cette tendance est due au creux du premier confinement et à l'augmentation qui a suivi le premier confinement alors que les températures augmentaient, comme le suggère l'analyse suivante.

```{r}
parkstsd <- tsd(parkstsclean, method = "loess", s.window = 13, trend = TRUE)
plot(parkstsd, col = 1:3)
```

On peut conclure que les parcs ont subit une diminution drastique au moment du premier confinement. Cependant, le second confinement ne semble pas être accompagné d'une diminution de la fréquentation des parcs, ce qui peut être du à 2 facteurs principaux : les températures froides de novembre-décembre et des restrictions plus laxistes durant le second confinement.

### Influence sur la fréquentation des stations de transports en commun

```{r}
transit <- ts(feur$transit)

dates <- seq(as.Date("2020-02-15"), by = "day", length.out = length(transit))
z <- zoo(transit, dates)
plot(z, type = "l", xlab = "Dates", ylab = "Variation de la fréquentation des stations de transport en commun")
abline(v = as.Date("2020-03-18"), col = "2", lty = 3)
abline(v = as.Date("2020-05-04"), col = "3", lty = 3)
abline(v = as.Date("2020-10-20"), col = "2", lty = 3)
abline(v = as.Date("2021-02-01"), col = "3", lty = 3)
```

Dans cette analyse, on constate encore une fois un creux drastique au moment du premier confinement et un autre nettement moins important au moment du second.

```{r}
transitsd <- tsd(transit, method = "average", order = 15, time = 3)
plot(transitsd, col = 1:3)
transitts<- tseries(transitsd)
spectrum(transitts[,"filtered"], spans = c(3,5))
```

Cette seconde analyse met en évidence ce premier creux. De plus, l'analyse spectrale montre un cycle hebdomadaire non significatif mais qui nous indique qu'il s'agirait d'une corrélation avec les jours de travail. Dans cette analyse, on voit aussi un cycle annuel très marqué mais qui semble moins explicatif que dans d'autres analyses.

On peut conclure de cette analyse que le creux du premier confinement correspondait à une volonté d'endiguer le virus avec une fermeture complète des stations de transport en commun. le second confinement, quant à lui explicatif d'une volonté d'endiguer le virus tout en continuant à garder l'économie à flot en permettant au gens de continuers à travailler.

## Discussion et Conclusion

<!--% En tenant compte du but de votre carnet de notes et de vos résultats, discutez de résultats et proposez des conclusions à votre analyse en 5 à 10 phrases. -->

En conclusion, le premier confinement était une volonté de freiner la progression du virus au détriment de l'économie. En effet, le covid a provoqué la plus grande crise économique que l'humanité ait connue. Le premier confinement aurait permis une progression de la recherche pour un remède contre le covid dans un intervalle de temps le plus petit possible. Cependant, avec l'apparition de nouveaux variants accompagnée d'une virulence accrue, le résultats en fut tout autre : une économie qui s'est écroulée mais un virus toujours aussi présent. Pour cette raison, au lieu de rétablir un confinement très strict et court, le gouvernement misera plûtot sur un confinement moins ferme mais de plus longue durée pour ralentir la progression du virus tout en favorisant la recherche et l'économie.

Les épiceries et pharmacies sont très impactées au début du confinement, puis la fréquentation recommence à augmenter, de plus en plus, sans d'autres variations, il n'y a pas de rechute de fréquentation durant les mois qui suivent. Concernant les lieux de ventes de détail et de loisirs, ils fluctuent approximativement de la même manière que les épiceries et pharmacies, un grand impact au début du confinement puis une tendance à la hausse sans grandes variations.

Les zones résidentielles sont évidemment très fortement fréquentées lors du confinement, et la tendance de fréquentation semble être restée imprimée dans les habtiudes post-confinement. Ceci peut être lié au télétravail qui s'est fortement développé lors du confinement et qui est resté dans les habitudes par après.
